#!/bin/bash


echo "ğŸ” Markdown ë§í¬ ê²€ì‚¬ ì¤‘..."

# Markdown íŒŒì¼ì„ ì¬ê·€ì ìœ¼ë¡œ ê²€ìƒ‰í•˜ì—¬ [text](url) íŒ¨í„´ì˜ http/https ë§í¬ë§Œ ì¶”ì¶œ
grep -rPo '\[.*?\]\(\Khttps?://[^\)]+' --include="*.md","*.mdx" . > /tmp/all_links.txt

# ì¤‘ë³µ ì œê±°
sort -u /tmp/all_links.txt > /tmp/unique_links.txt


# ê° íŒŒì¼ë§ˆë‹¤ ë§í¬ ê²€ì‚¬
while IFS= read -r file; do
    while IFS= read -r url; do
        # í•´ë‹¹ íŒŒì¼ì— í¬í•¨ëœ ë§í¬ì¸ì§€ í™•ì¸
        if grep -q "$url" "$file"; then
            status=$(curl -o /dev/null -s -w "%{http_code}" "$url")
            if [[ "$status" -ge 400 || "$status" -eq 000 ]]; then
                echo "âŒ $file â†’ $url (Status: $status)"
            fi
        fi
    done < /tmp/unique_links.txt
done < <(find . -type f -name "*.md")

# ì„ì‹œíŒŒì¼ ì‚­ì œ
rm /tmp/all_links.txt /tmp/unique_links.txt
